# Дипломная работа по профессии «Системный администратор» - Липин Роман

Задание по дипломной работе - https://github.com/netology-code/sys-diplom/tree/diplom-zabbix

Подготовка рабочего места оператора описана в отдельном документе - [operator.md](<operator.md>)

## Оглавление

* [Инфраструктура](#Инфраструктура)
* [Сайт](#Сайт)
* [Мониторинг](#Мониторинг)
* [Логи](#Логи)
* [Сеть](#Сеть)
* [Резервное копирование](#Резервное-копирование)

## Инфраструктура

Для автоматического развертывания инфраструктуры использовался terraform, в конфигурации виртуальных машин подключался файл cloud-init ([metadata.yaml](metadata.yaml)) с помощью которого создавался пользователь для удаленного доступа по SSH. С документацией по работе с cloud-init можно ознакомиться на сайте [cloudinit.readthedocs.io](<https://cloudinit.readthedocs.io/en/latest/>).

Для доступа к серверам и проверки дипломной работы был сгенерирован дополнительный ([ssh ключ](.ssh/diplom))

Подключение через джамп сервер:

~~~ bash
ssh -i ~/.ssh/diplom -J user@51.250.45.0 user@local_hostname
~~~

Для удобства чтения конфигурация terraform разделена на несколько файлов:
- [main.tf](main.tf) - основной файл конфигурации
- [outputs.tf](outputs.tf) - файл выходных значений
- [variables.tf](variables.tf) - файл переменных
- [vm.tf](vm.tf) - файл конфигурации виртуальных машин

Адреса развернутых серверов:

|Сервис|FQDN имя|Внутренний IP адрес|Внешний адрес|
|---|---|---|---|
|nginx|nginx-1.ru-central1.internal|192.168.10.32|-|
|nginx|nginx-2.ru-central1.internal|192.168.20.34|-|
|elasticsearch|elastic.ru-central1.internal|192.168.30.29|-|
|kibana|kebana.ru-central1.internal|192.168.40.4|51.250.43.240:5601|
|zabbix|zabbix.ru-central1.internal|192.168.40.26|51.250.36.235:80|
|bastion|bastion.ru-central1.internal|192.168.40.16|51.250.45.0:22|
|load balancer|-|-|158.160.107.117:80|

Для работы с ansible динамически формируются файл конфигурации и файл hosts, используется механизм выходных значений [output values](<https://developer.hashicorp.com/terraform/language/values/outputs>).

## Сайт

Было развернуто 6 виртуальных машин, из них 2 веб сервера в разных зонах:

![01](01.png)

Создана целевая группа:

![02](img/02.png)

Создана группа бэкендов:

![03](img/03.png)

Создан HTTP роутер:

![04](img/04.png)

Создан балансировщик:

![05](img/05.png)

Проведено тестирование балансировщика:

~~~ bash
curl -v 158.160.35.166:80
~~~

![06](img/06.png)

## Мониторинг

Развернутая виртуальная машина с zabbix доступна по адресу http://51.250.36.235/

Логин: Admin

Пароль zabbix

Проведена настройка панелей:

![07](img/07.png)

## Логи

Развернутая виртуальная машина с kibana доступна по адресу http://51.250.43.240:5601

Проведена настройка отправки логов:

![08](img/08.png)

## Сеть

Создана сеть:

![09](img/09.png)

Созданы подсети:

![10](img/10.png)

Созданы группы безопасности:

![11](img/11.png)

## Резервное копирование

Созданы снимки дисков:

![12](img/12.png)

Создано расписание снимков:

![13](img/13.png)

Раснисание было настроено на 5 дней, т.к. развернуто 6 вирутальных машин, а имеющиеся квоты ограничены 32 дисками:

![14](img/14.png)
